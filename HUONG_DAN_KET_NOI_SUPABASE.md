# HÆ°á»›ng Dáº«n Káº¿t Ná»‘i Supabase Cá»§a Báº¡n

HÆ°á»›ng dáº«n nÃ y sáº½ giÃºp báº¡n káº¿t ná»‘i á»©ng dá»¥ng vá»›i Supabase project riÃªng cá»§a báº¡n. LÃ m theo tá»«ng bÆ°á»›c bÃªn dÆ°á»›i vÃ  báº¡n sáº½ thÃ nh cÃ´ng!

---

## BÆ°á»›c 1: Táº¡o Supabase Project

1. Truy cáº­p [https://supabase.com](https://supabase.com)
2. ÄÄƒng nháº­p hoáº·c Ä‘Äƒng kÃ½ tÃ i khoáº£n má»›i (miá»…n phÃ­)
3. Click vÃ o nÃºt **"New Project"**
4. Äiá»n thÃ´ng tin:
   - **Project Name**: Äáº·t tÃªn project cá»§a báº¡n (vÃ­ dá»¥: `bluebolt-management`)
   - **Database Password**: Táº¡o máº­t kháº©u máº¡nh (lÆ°u láº¡i máº­t kháº©u nÃ y)
   - **Region**: Chá»n region gáº§n báº¡n nháº¥t (vÃ­ dá»¥: `Southeast Asia (Singapore)`)
   - **Pricing Plan**: Chá»n **Free** Ä‘á»ƒ báº¯t Ä‘áº§u
5. Click **"Create new project"** vÃ  Ä‘á»£i 1-2 phÃºt Ä‘á»ƒ Supabase khá»Ÿi táº¡o

---

## BÆ°á»›c 2: Láº¥y API Keys vÃ  URL

Sau khi project Ä‘Æ°á»£c táº¡o xong:

1. VÃ o menu bÃªn trÃ¡i, click vÃ o **Settings** (icon bÃ¡nh rÄƒng âš™ï¸)
2. Click vÃ o **API** trong menu Settings
3. Báº¡n sáº½ tháº¥y thÃ´ng tin sau:

### ThÃ´ng tin cáº§n láº¥y:

- **Project URL**: CÃ³ dáº¡ng `https://xxxxxxxxxxx.supabase.co`
- **Project Reference ID**: Pháº§n `xxxxxxxxxxx` trong URL (vÃ­ dá»¥: `lnkcxrkwfcgpjrjrkqqw`)
- **anon/public key**: Key dÃ i báº¯t Ä‘áº§u báº±ng `eyJhbGciOi...`

> **LÆ°u Ã½**: CÃ³ 2 loáº¡i key:
> - `anon public`: DÃ¹ng cho frontend (an toÃ n Ä‘á»ƒ public)
> - `service_role`: DÃ¹ng cho backend (KHÃ”NG BAO GIá»œ Ä‘á»ƒ lá»™ key nÃ y)
>
> ChÃºng ta chá»‰ cáº§n **anon public key**

---

## BÆ°á»›c 3: Cáº­p Nháº­t File `.env`

Má»Ÿ file `.env` á»Ÿ thÆ° má»¥c gá»‘c cá»§a project vÃ  cáº­p nháº­t:

```env
VITE_SUPABASE_URL=https://xxxxxxxxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOi...
```

**Thay tháº¿**:
- `https://xxxxxxxxxxx.supabase.co` báº±ng **Project URL** cá»§a báº¡n
- `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOi...` báº±ng **anon public key** cá»§a báº¡n

**VÃ­ dá»¥ cá»¥ thá»ƒ**:
```env
VITE_SUPABASE_URL=https://lnkcxrkwfcgpjrjrkqqw.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxua2N4cmt3ZmNncGpyanJrcXF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNDE3NDIsImV4cCI6MjA4MzcxNzc0Mn0.PRwM50-QHNamzHGVxJ3ueAaCpz_GAaYl7pdsabqV1_M
```

---

## BÆ°á»›c 4: Cáº­p Nháº­t File `src/utils/supabase/info.tsx`

Má»Ÿ file `src/utils/supabase/info.tsx` vÃ  thay Ä‘á»•i:

```typescript
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "xxxxxxxxxxx"  // Thay báº±ng Project Reference ID cá»§a báº¡n
export const publicAnonKey = "eyJhbGciOi..."  // Thay báº±ng anon public key cá»§a báº¡n
```

**VÃ­ dá»¥ cá»¥ thá»ƒ**:
```typescript
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "lnkcxrkwfcgpjrjrkqqw"
export const publicAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxua2N4cmt3ZmNncGpyanJrcXF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNDE3NDIsImV4cCI6MjA4MzcxNzc0Mn0.PRwM50-QHNamzHGVxJ3ueAaCpz_GAaYl7pdsabqV1_M"
```

---

## BÆ°á»›c 5: Deploy Edge Function

á»¨ng dá»¥ng nÃ y sá»­ dá»¥ng **Supabase Edge Functions** Ä‘á»ƒ xá»­ lÃ½ API. Báº¡n cáº§n deploy function lÃªn Supabase cá»§a báº¡n.

> **LÆ°u Ã½**: Edge Function code náº±m trong thÆ° má»¥c `supabase/functions/make-server-393f5b29/`

### 5.1. CÃ i Ä‘áº·t Supabase CLI

**TrÃªn macOS**:
```bash
brew install supabase/tap/supabase
```

**TrÃªn Windows**:
```powershell
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase
```

**TrÃªn Linux**:
```bash
brew install supabase/tap/supabase
```

### 5.2. Login vÃ o Supabase

```bash
supabase login
```

Má»™t trÃ¬nh duyá»‡t sáº½ má»Ÿ ra Ä‘á»ƒ báº¡n Ä‘Äƒng nháº­p. Sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng, quay láº¡i terminal.

### 5.3. Link Project

```bash
supabase link --project-ref xxxxxxxxxxx
```

**Thay tháº¿** `xxxxxxxxxxx` báº±ng **Project Reference ID** cá»§a báº¡n (vÃ­ dá»¥: `lnkcxrkwfcgpjrjrkqqw`)

Khi Ä‘Æ°á»£c há»i database password, nháº­p password báº¡n Ä‘Ã£ táº¡o á»Ÿ BÆ°á»›c 1.

### 5.4. Deploy Edge Function

```bash
supabase functions deploy make-server-393f5b29 --no-verify-jwt
```

Äá»£i vÃ i giÃ¢y Ä‘á»ƒ function Ä‘Æ°á»£c deploy. Báº¡n sáº½ tháº¥y thÃ´ng bÃ¡o thÃ nh cÃ´ng:

```
Deploying function make-server-393f5b29...
Function deployed successfully!
URL: https://xxxxxxxxxxx.supabase.co/functions/v1/make-server-393f5b29
```

> **LÆ°u Ã½ vá» `--no-verify-jwt`**: Flag nÃ y cho phÃ©p function hoáº¡t Ä‘á»™ng mÃ  khÃ´ng cáº§n xÃ¡c thá»±c JWT. Náº¿u báº¡n muá»‘n báº£o máº­t hÆ¡n, hÃ£y bá» flag nÃ y vÃ  cáº­p nháº­t code frontend Ä‘á»ƒ gá»­i JWT token trong header.

---

## BÆ°á»›c 6: Test Káº¿t Ná»‘i

### 6.1. Test Edge Function

Má»Ÿ trÃ¬nh duyá»‡t hoáº·c dÃ¹ng curl Ä‘á»ƒ test:

```bash
curl https://xxxxxxxxxxx.supabase.co/functions/v1/make-server-393f5b29/health
```

**Thay tháº¿** `xxxxxxxxxxx` báº±ng Project Reference ID cá»§a báº¡n.

Náº¿u thÃ nh cÃ´ng, báº¡n sáº½ nháº­n Ä‘Æ°á»£c:
```json
{"status":"ok"}
```

### 6.2. Khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng

```bash
npm install
npm run dev
```

á»¨ng dá»¥ng sáº½ cháº¡y táº¡i `http://localhost:5173`

### 6.3. Test chá»©c nÄƒng

1. ÄÄƒng nháº­p vá»›i má»™t trong cÃ¡c tÃ i khoáº£n demo:
   - **Email**: `ceo@bluebolt.vn`
   - **Password**: `ceo123`

2. Thá»­ táº¡o má»™t Business Unit má»›i hoáº·c Transaction Ä‘á»ƒ kiá»ƒm tra káº¿t ná»‘i

---

## BÆ°á»›c 7: Seed Dá»¯ Liá»‡u Máº«u (TÃ¹y chá»n)

Äá»ƒ cÃ³ dá»¯ liá»‡u máº«u ban Ä‘áº§u, báº¡n cÃ³ thá»ƒ gá»i endpoint seed:

```bash
curl -X POST https://xxxxxxxxxxx.supabase.co/functions/v1/make-server-393f5b29/seed \
  -H "Authorization: Bearer YOUR_ANON_KEY"
```

**Thay tháº¿**:
- `xxxxxxxxxxx` báº±ng Project Reference ID cá»§a báº¡n
- `YOUR_ANON_KEY` báº±ng anon public key cá»§a báº¡n

Hoáº·c Ä‘Æ¡n giáº£n hÆ¡n, dÃ¹ng browser Ä‘á»ƒ truy cáº­p:
```
https://xxxxxxxxxxx.supabase.co/functions/v1/make-server-393f5b29/seed
```

---

## Xá»­ LÃ½ Lá»—i ThÆ°á»ng Gáº·p

### Lá»—i: "Failed to fetch" hoáº·c "Network error"

**NguyÃªn nhÃ¢n**: Edge Function chÆ°a Ä‘Æ°á»£c deploy hoáº·c URL khÃ´ng Ä‘Ãºng

**Giáº£i phÃ¡p**:
1. Kiá»ƒm tra láº¡i Project Reference ID trong `src/utils/supabase/info.tsx`
2. Cháº¯c cháº¯n Edge Function Ä‘Ã£ Ä‘Æ°á»£c deploy thÃ nh cÃ´ng
3. Test endpoint `/health` báº±ng curl hoáº·c browser

### Lá»—i: "Invalid API key"

**NguyÃªn nhÃ¢n**: Anon key khÃ´ng Ä‘Ãºng

**Giáº£i phÃ¡p**:
1. VÃ o Supabase Dashboard > Settings > API
2. Copy láº¡i **anon public key**
3. Cáº­p nháº­t vÃ o file `.env` vÃ  `src/utils/supabase/info.tsx`
4. Restart á»©ng dá»¥ng (`npm run dev`)

### Lá»—i: "Function not found"

**NguyÃªn nhÃ¢n**: Edge Function chÆ°a Ä‘Æ°á»£c deploy hoáº·c tÃªn function khÃ´ng Ä‘Ãºng

**Giáº£i phÃ¡p**:
1. Cháº¯c cháº¯n báº¡n Ä‘Ã£ cháº¡y: `supabase functions deploy make-server-393f5b29`
2. Kiá»ƒm tra trong Supabase Dashboard > Edge Functions xem function Ä‘Ã£ cÃ³ chÆ°a

### Lá»—i: "CORS error"

**NguyÃªn nhÃ¢n**: Edge Function khÃ´ng cho phÃ©p CORS tá»« domain cá»§a báº¡n

**Giáº£i phÃ¡p**:
- Edge Function Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh CORS vá»›i `origin: "*"`, nÃªn lá»—i nÃ y hiáº¿m khi xáº£y ra
- Náº¿u váº«n gáº·p, kiá»ƒm tra láº¡i file `src/supabase/functions/server/index.tsx`

---

## LÆ°u Ã Quan Trá»ng

1. **KHÃ”NG BAO GIá»œ** commit file `.env` lÃªn Git
2. **KHÃ”NG BAO GIá»œ** share `service_role` key vá»›i ai
3. File `.gitignore` Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ bá» qua `.env`
4. Edge Function sá»­ dá»¥ng **Supabase KV Store** (key-value storage), khÃ´ng pháº£i Postgres
5. Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong KV Store sáº½ persist (khÃ´ng máº¥t khi restart)

---

## NÃ¢ng Cao: Cáº¥u HÃ¬nh RLS (Row Level Security)

Hiá»‡n táº¡i á»©ng dá»¥ng sá»­ dá»¥ng KV Store nÃªn khÃ´ng cÃ³ RLS. Náº¿u sau nÃ y báº¡n muá»‘n chuyá»ƒn sang Postgres:

1. Táº¡o cÃ¡c báº£ng trong Supabase Dashboard > SQL Editor
2. Enable RLS cho má»—i báº£ng
3. Táº¡o policies phÃ¹ há»£p
4. Cáº­p nháº­t code trong `src/supabase/functions/server/api.tsx` Ä‘á»ƒ sá»­ dá»¥ng Postgres thay vÃ¬ KV Store

---

## Há»— Trá»£

Náº¿u gáº·p váº¥n Ä‘á», báº¡n cÃ³ thá»ƒ:
1. Kiá»ƒm tra láº¡i tá»«ng bÆ°á»›c trong hÆ°á»›ng dáº«n nÃ y
2. Xem logs cá»§a Edge Function trong Supabase Dashboard > Edge Functions > Logs
3. Má»Ÿ Developer Tools trong browser (F12) vÃ  kiá»ƒm tra tab Network/Console

---

## Checklist Tá»•ng Há»£p

- [ ] ÄÃ£ táº¡o Supabase project má»›i
- [ ] ÄÃ£ láº¥y Project URL vÃ  anon key
- [ ] ÄÃ£ cáº­p nháº­t file `.env`
- [ ] ÄÃ£ cáº­p nháº­t file `src/utils/supabase/info.tsx`
- [ ] ÄÃ£ cÃ i Ä‘áº·t Supabase CLI
- [ ] ÄÃ£ login vÃ  link project
- [ ] ÄÃ£ deploy Edge Function thÃ nh cÃ´ng
- [ ] ÄÃ£ test endpoint `/health` thÃ nh cÃ´ng
- [ ] ÄÃ£ cháº¡y `npm install` vÃ  `npm run dev`
- [ ] ÄÃ£ test Ä‘Äƒng nháº­p vÃ  cÃ¡c chá»©c nÄƒng cÆ¡ báº£n

---

**ChÃºc báº¡n thÃ nh cÃ´ng! ğŸ‰**
